(window.webpackJsonp=window.webpackJsonp||[]).push([[269],{4223:function(t,e,r){"use strict";r.r(e);var n=r(6187),i=r(4428),o=r(155),s=r(4),a=r(3),c=r(469),u=r(896);class BNBCoin extends(Object(c.l)(Object(c.g)(Object(c.h)(o.a)))){constructor({alias:t,feeData:e,explorers:r,txWebUrl:i,socket:o}){super({alias:t,name:"BNB Coin",ticker:"BNB",decimal:8,derivation:void 0,unspendableBalance:"0",explorers:r,txWebUrl:i,socket:o,feeData:e}),this.plugins=[new u.a],this.fee=e.fee,this.freezeFee=e.freezeFee||"500000",this.reserveForStake=e.reserveForStake||"500000",this.transactions=[],this.predefinedValidators=[],this.coreLibraryLoaded=!1,this.coreLibrary=new n.BncClient("https://dex-atlantic.binance.org/"),this.coreLibrary.chooseNetwork("mainnet"),this.tokens={},this.fields.paymentId=!0}async loadWallet(t,e){return this.privateKey=n.crypto.getPrivateKeyFromMnemonic(e),this.address=n.crypto.getAddressFromPrivateKey(this.privateKey,this.coreLibrary.addressPrefix),this.loadCoreLibrary(),this}loadCoreLibrary(){this.coreLibrary.initChain().then(()=>{console.warn("BNB core init went OK"),this.coreLibrary.setPrivateKey(this.privateKey),this.coreLibraryLoaded=!0}).catch(t=>{console.error("BNB coreLibrary load FAILED.\n          It would be attemp to re-initialize during each\n          sendTransaction call. Error thrown:",t)})}async getTransaction(t){const e=this.transactions.filter(e=>e.txid===t);return e.length>0?e[0]:{}}getPublicKey(){return n.crypto.getPublicKeyFromPrivateKey(this.privateKey)}getAddress(){if(!this.address){if(!this.privateKey)throw new Error("BNB: Could not load address from core library because the privateKey is not set");this.address=n.crypto.getAddressFromPrivateKey(this.privateKey)}return this.address}async validateAddress(t){return n.crypto.checkAddress(t,"bnb")}async createTransaction({address:t,amount:e,memo:r,asset:n="BNB"}){return{address:t,amount:e,memo:r,asset:n}}createDelegationTransaction({account:t,toValidator:e,amount:r,symbol:n="BNB",sideChainId:i="bsc"}){return{delegateAddress:t,validatorAddress:e,amount:r,symbol:n,sideChainId:i}}createUnDelegationTransaction({account:t,toValidator:e,amount:r,symbol:n="BNB",sideChainId:i="bsc"}){return{delegateAddress:t,validatorAddress:e,amount:r,symbol:n,sideChainId:i}}createReDelegationTransaction({account:t,fromValidator:e,toValidator:r,amount:n,symbol:i="BNB",sideChainId:o="bsc"}){return{delegateAddress:t,validatorSrcAddress:e,validatorDstAddress:r,amount:n,symbol:i,sideChainId:o}}async sendDelegationTransaction(t){this.coreLibraryLoaded||await this.loadCoreLibrary();const{status:e,result:r}=await this.coreLibrary.stake.bscDelegate(t);if(200!==e)throw new Error(`${this.ticker}: sendDelegationTransaction error: ${JSON.stringify(r)}`);const n=r[0];if(!n.ok)throw new Error(`BNB: asset (${this.ticker}) : sendDelegationTransaction error:\n        coreLib.transfer is not ok, got: ${JSON.stringify(r)}`);return{txid:n.hash}}async sendUnDelegationTransaction(t){this.coreLibraryLoaded||await this.loadCoreLibrary();const{status:e,result:r}=await this.coreLibrary.stake.bscUndelegate(t);if(200!==e)throw new Error(`${this.ticker}: sendUnDelegationTransaction error: ${JSON.stringify(r)}`);const n=r[0];if(!n.ok)throw new Error(`BNB: asset (${this.ticker}) : sendUnDelegationTransaction error:\n        coreLib.transfer is not ok, got: ${JSON.stringify(r)}`);return{txid:n.hash}}async sendReDelegationTransaction(t){return this.coreLibraryLoaded||await this.loadCoreLibrary(),this.coreLibrary.stake.bscReDelegate(t)}async createTokenTransaction(t){return t}async signOrder(t){return n.crypto.generateSignature(this.toHex(JSON.stringify(t)),this.privateKey).toString("hex")}toHex(t){let e="";for(let r=0;r<t.length;r+=1){e+=t.charCodeAt(r).toString(16)}return e}async getFee(){return new this.BN(this.fee)}async getFreezeFee(){return new this.BN(this.freezeFee)}async getInfo(){await this.getBalance();const t=await this.getProvider("staking").getStakingBalances(this.address);return t&&(t.total=this.toCurrencyUnit(t.total.add(new this.BN(this.balance))),t.available=await this.availableBalance(),this.balances=t),{balance:this.balance,balances:t,transactions:[]}}async getBalance(){const t=await this.getProvider("balance").getBalance(this.address);if(!t)return this.balance;for(const e of Object.values(this.tokens)){const r=t.find(t=>t.asset===e.ticker),n=r?new this.BN(e.toMinimalUnit(r.free)).add(new this.BN(e.toMinimalUnit(r.frozen))).add(new this.BN(e.toMinimalUnit(r.locked))):"0";e.balance=n.toString(),e.balances.frozen=r?String(r.frozen):"0",e.balances.locked=r?String(r.locked):"0",e.balances.available=r?String(r.free):e.divisibleBalance}const e=t.find(t=>t.asset===this.ticker);return e?(this.balance=this.toMinimalUnit(e.free),this.balance):(this.balance="0",this.balance)}async sendTransaction({address:t,amount:e,memo:r,asset:n="BNB"}){const i=this.address,o=this.toCurrencyUnit(e);this.coreLibraryLoaded||(await this.coreLibrary.initChain(),this.coreLibrary.setPrivateKey(this.privateKey),this.coreLibraryLoaded=!0);const{result:s,status:a}=await this.coreLibrary.transfer(i,t,o,n,r);if(200!==a)throw new Error(`${this.ticker}: sendTransaction error: ${JSON.stringify(s)}`);const c=s[0];if(!c.ok)throw new Error(`BNB: asset (${n}) : sendTransaction error:\n        coreLib.transfer is not ok, got: ${JSON.stringify(s)}`);return{txid:c.hash}}async sendMultiTransaction(t){this.coreLibraryLoaded||await this.loadCoreLibrary();const{result:e,status:r}=await this.coreLibrary.BncClient.multiSend(this.address,t);if(200!==r)throw new Error(`${this.ticker}: sendTransaction error: ${JSON.stringify(e)}`);const n=e[0];if(!n.ok)throw new Error("BNB: sendTransaction error:\n        coreLib.transfer is not ok, got: "+JSON.stringify(e));return{txid:n.hash}}async placeOrder(t,e,r=1,n=this.address,i="AWC-986_BNB",o=null,c=3){await this.coreLibrary.initChain();return await this.coreLibrary.placeOrder(n,i,r,e,t,o,c).catch(t=>{throw new s.i({type:a.s,error:new Error("place Order failed: "+t.message),instance:this})})}async getPlaceOrderTx(t){await this.coreLibrary.initChain();return await this.coreLibrary.getTx(t).catch(t=>{throw new s.i({type:"GetTx",error:new Error("get tx failed: "+t.message),instance:this})})}setPrivateKey(t){super.setPrivateKey(t),this.coreLibrary.setPrivateKey(t)}createToken(...t){return new i.a(this.ticker,...t)}async getTokenList(t=[]){return this.getProvider("node").getAtomicTokenList()}async getUserTokenList(){const t=await this.coreLibrary.getBalance(this.address);if(!t)return[];const e=t.map(t=>t.symbol).filter(t=>t.toLowerCase()!==this.ticker.toLowerCase());return this.getProvider("node").getTokenList(e)}getExcludedTokenList(){return["BNB"]}async getTransactions({address:t=this.address}={}){const{transactions:e=[]}=await this.getProvider("history").getTransactions({address:t});return e}getTokenObject(t,e){return{contract:t.owner,name:t.name,ticker:t.symbol,decimal:8,parentTicker:"BNB",uniqueField:t.symbol,isCustom:!1}}async freezeTokenBalance(t,e){await this.coreLibrary.initChain();const r=await this.coreLibrary.tokens.freeze(this.address,t,String(e));if(r.result&&r.result.length>0)return r.result[0].hash;if(200!==r.status)throw new s.i({type:"Freeze amount",error:new Error(`Freeze amount for ${t} is failed: ${r.error}`),instance:this});return r}async unfreezeTokenBalance(t,e){await this.coreLibrary.initChain();const r=await this.coreLibrary.tokens.unfreeze(this.address,t,String(e));if(r.result&&r.result.length>0)return r.result[0].hash;if(200!==r.status)throw new s.i({type:"Freeze amount",error:new Error(`Unfreeze amount for ${t} is failed: ${r.error}`),instance:this});return r}async connectSocket(){this.getProvider("socket").connectSocket(this.address)}async updateBalances(t){const e=Object.values(this.tokens);t.forEach(t=>{const r=t.a;if("BNB"===r)return void(this.balance=this.toMinimalUnit(t.f));const n=e.find(t=>t.ticker===r);if(!n)return void console.warn(r+" is not found in the BNB token list. Balance update skipped.");const i=t.f,o=t.l,s=t.r,a=new this.BN(n.toMinimalUnit(i)).add(new this.BN(n.toMinimalUnit(s))).add(new this.BN(n.toMinimalUnit(o)));n.balance=a.toString(),n.balances.frozen=s,n.balances.locked=o,n.balances.available=i})}async availableBalance(t){const e=this.balance;if(!e)return null;const r=t&&new this.BN(t)||await this.getFee(),n=new this.BN(e).sub(r).sub(new this.BN(this.unspendableBalance)).sub(new this.BN(this.reserveForStake));return new this.BN(n).lt(new this.BN(0))?"0":this.toCurrencyUnit(n)}get instance(){return{id:this.id,ticker:this.ticker,name:this.name,alias:this.alias,assetName:this.assetName,decimal:this.decimal,parent:this.parent,BN:this.BN,tokens:()=>this.tokens,toCurrencyUnit:t=>this.toCurrencyUnit(t),toMinimalUnit:t=>this.toMinimalUnit(t),updateBalances:(...t)=>this.updateBalances(...t),feeCoefficient:this.coefficient,feeDefault:this.feeData&&this.feeData.fee}}}e.default=BNBCoin},4428:function(t,e,r){"use strict";r.d(e,"c",(function(){return a})),r.d(e,"b",(function(){return c})),r.d(e,"g",(function(){return u})),r.d(e,"a",(function(){return h})),r.d(e,"h",(function(){return l})),r.d(e,"i",(function(){return d})),r.d(e,"e",(function(){return b})),r.d(e,"d",(function(){return y})),r.d(e,"f",(function(){return THETAToken_THETAToken}));var n=r(31),i=r(394),o=r(4),s=r(3);class ETHToken_ETHToken extends i.a{constructor(...t){super(...t),this.gasLimit="150000",this.coefficient=1}async getInfo(){return{balance:String(this.balance),transactions:this.transactions}}async getFee({amount:t=0,isSendAll:e,gasPrice:r,gasLimit:n}){const i=Number(r.toString())*Number(this.coefficient),o=n||this.gasLimit;return new this.BN(o).mul(new this.BN(i))}getFeeSettings(){return n.a.get("eth-gas-price")}async createTransaction({address:t,amount:e,custom:r,userGasPrice:n,gasLimit:i=this.gasLimit,multiplier:o=this.multiplier,nonce:s}){return{address:t,amount:e,custom:r,userGasPrice:n,gasLimit:i,contract:this.contract,multiplier:o,nonce:s}}async sendTransaction(t){return new Promise((e,r)=>{this.web3.eth.sendSignedTransaction(t).on("transactionHash",t=>{e({txid:t})}).catch(t=>{const e=this.parent.coreLibrary.currentProvider.host,n=new o.d({type:s.s,error:t,url:e,instance:this});r(n)})})}}var a=ETHToken_ETHToken;class BSCToken_BSCToken extends i.a{constructor(...t){super(...t),this.gasLimit="150000",this.coefficient=1}async getInfo(){return{balance:String(this.balance),transactions:this.transactions}}async getFee({amount:t=0,isSendAll:e,gasPrice:r,gasLimit:n}){const i=Number(r.toString())*Number(this.coefficient),o=n||this.gasLimit;return new this.BN(o).mul(new this.BN(i))}async createTransaction({address:t,amount:e,custom:r,userGasPrice:n,gasLimit:i=this.gasLimit,multiplier:o=this.multiplier,nonce:s}){return{address:t,amount:e,custom:r,userGasPrice:n,gasLimit:i,contract:this.contract,multiplier:o,nonce:s}}async sendTransaction(t){return new Promise((e,r)=>{this.web3.eth.sendSignedTransaction(t).on("transactionHash",t=>{e({txid:t})}).catch(t=>{const e=this.parent.coreLibrary.currentProvider.host,n=new o.d({type:s.s,error:t,url:e,instance:this});r(n)})})}}var c=BSCToken_BSCToken;class TRXToken_TRXToken extends i.a{async createTransaction({address:t,amount:e}){return{address:t,amount:e,contract:this.contract,transfer:!0,feeLimit:1e7}}getUserTicker(){return-1!==this.ticker.indexOf("-")&&this.ticker.split("-")[1]||this.ticker}}var u=TRXToken_TRXToken;class BNBToken_BNBToken extends i.a{constructor(...t){super(...t),this.fields.paymentId=!0,this.balances={}}async availableBalance(){return this.balances&&this.balances.available?this.balances.available:this.divisibleBalance?String(this.divisibleBalance):"0"}async getInfo(){return await this.getBalance(),{balance:String(this.balance),transactions:this.transactions}}async createTransaction({address:t,amount:e,memo:r}){return{address:t,amount:e,memo:r,asset:this.ticker}}async getBalance(){return this.balance}async getTransactions(){return this.transactions}getUserTicker(){return this.ticker.split("-")[0]}}var h=BNBToken_BNBToken;class VETToken_VETToken extends i.a{constructor(...t){super(...t),this.fee="60"}get feeTicker(){return"VTHO"}async getInfo(){return{balance:String(this.balance),transactions:this.transactions}}async getFee(){return new this.BN(this.toMinimalUnit(this.fee))}async createTransaction({address:t,amount:e}){const r=Number(this.toCurrencyUnit(await this.getFee())),n=`0xa9059cbb${this.addLeadingZero(t.substring(2),64)}${this.addLeadingZero(new this.BN(e).toString(16),64)}`;return{contract:this.contract,amount:"0",dataToSend:n,fee:r}}async isAvailableForFee(){const t=await this.getFee();return this.indivisibleBalance.gte(t)}async availableBalance(){const t=await this.getFee(),e=new this.BN(this.balance).sub(t);return e.lt(new this.BN(0))?"0":this.toCurrencyUnit(e)}addLeadingZero(t,e){return String(t).padStart(e,"0")}}var l=VETToken_VETToken;class ZILToken_ZILToken extends i.a{async createTransaction({address:t,amount:e}){return{address:t,amount:e,contract:this.contract}}}var d=ZILToken_ZILToken,f=r(16),p=r.n(f);class MATICToken_MATICToken extends i.a{constructor(...t){super(...t),this.gasLimit="150000",this.coefficient=1,this.BN=p.a}async getInfo(){return{balance:String(this.balance),transactions:this.transactions}}async getFee({gasPrice:t,gasLimit:e}){const r=new this.BN(t.toString()).mul(new this.BN(this.coefficient)),n=e||this.gasLimit;return new this.BN(n).mul(new this.BN(r))}async createTransaction({address:t,amount:e,custom:r,userGasPrice:n,gasLimit:i=this.gasLimit,multiplier:o=this.multiplier,nonce:s}){return{address:t,amount:e,custom:r,userGasPrice:n,gasLimit:i,contract:this.contract,multiplier:o,nonce:s}}async sendTransaction(t){return new Promise((e,r)=>{this.web3.eth.sendSignedTransaction(t).on("transactionHash",t=>{e({txid:t})}).catch(t=>{const e=this.parent.coreLibrary.currentProvider.host;r(new o.d({type:s.s,error:t,url:e,instance:this}))})})}}var b=MATICToken_MATICToken;class LUNCToken_LUNCToken extends i.a{constructor(...t){super(...t),this.denom=t[9],this.fields.paymentId=!0}async createTransaction({address:t,amount:e,userGasPrice:r,gasLimit:n,multiplier:i,feeLimit:o=1e7,memo:s}){return{address:t,amount:e,contract:this.contract,transfer:!0,ticker:this.ticker,userGasPrice:r,gasLimit:n,multiplier:i,feeLimit:o,denom:this.denom,memo:s}}}var y=LUNCToken_LUNCToken;class THETAToken_THETAToken extends i.a{constructor(...t){super(...t),this.id=this.ticker,this.network=this.config.network}async createTransaction({address:t,amount:e,userFee:r}){return{address:t,amount:e,contract:this.contract,ticker:this.ticker,userFee:r||await this.getFee()}}getFeeTicker(){return this.config.feeTicker}async availableBalance(t){if(!this.balance)return"0";const e=new p.a(this.balance).sub(new p.a(t));return e.gte(new p.a(0))?this.toCurrencyUnit(e):"0"}async isAvailableForSend(t,e){const r=await this.availableBalance(this.toMinimalUnit(e));return new p.a(this.toMinimalUnit(t)).lte(new p.a(this.toMinimalUnit(r)))}async getFee(){const t=this.config.defaultFee;if(!t)throw new Error(this.ticker+" provide defaultFee in config");return new this.BN(t)}}},4647:function(t,e,r){"use strict";r.r(e),r.d(e,"log",(function(){return o})),r.d(e,"listen",(function(){return s}));let n=0;const i=[],o=(t,e,r)=>{const o={type:t,id:String(++n),date:new Date};e&&(o.message=e),r&&(o.data=r),function(t){for(let e=0;e<i.length;e++)try{i[e](t)}catch(t){console.error(t)}}(o)},s=t=>(i.push(t),()=>{const e=i.indexOf(t);-1!==e&&(i[e]=i[i.length-1],i.pop())});"undefined"!=typeof window&&(window.__ledgerLogsListen=s)},4897:function(t,e,r){"use strict";r.d(e,"a",(function(){return Transport}));var n=r(60),i=r.n(n),o=r(4433);class Transport{constructor(){this.exchangeTimeout=3e4,this.unresponsiveTimeout=15e3,this.deviceModel=null,this._events=new i.a,this.send=async(t,e,r,n,i=Buffer.alloc(0),s=[o.StatusCodes.OK])=>{if(i.length>=256)throw new o.TransportError("data.length exceed 256 bytes limit. Got: "+i.length,"DataLengthTooBig");const a=await this.exchange(Buffer.concat([Buffer.from([t,e,r,n]),Buffer.from([i.length]),i])),c=a.readUInt16BE(a.length-2);if(!s.some(t=>t===c))throw new o.TransportStatusError(c);return a},this.exchangeBusyPromise=void 0,this.exchangeAtomicImpl=async t=>{if(this.exchangeBusyPromise)throw new o.TransportRaceCondition("An action was already pending on the Ledger device. Please deny or reconnect.");let e;const r=new Promise(t=>{e=t});this.exchangeBusyPromise=r;let n=!1;const i=setTimeout(()=>{n=!0,this.emit("unresponsive")},this.unresponsiveTimeout);try{const r=await t();return n&&this.emit("responsive"),r}finally{clearTimeout(i),e&&e(),this.exchangeBusyPromise=null}},this._appAPIlock=null}exchange(t){throw new Error("exchange not implemented")}setScrambleKey(t){}close(){return Promise.resolve()}on(t,e){this._events.on(t,e)}off(t,e){this._events.removeListener(t,e)}emit(t,...e){this._events.emit(t,...e)}setDebugMode(){console.warn("setDebugMode is deprecated. use @ledgerhq/logs instead. No logs are emitted in this anymore.")}setExchangeTimeout(t){this.exchangeTimeout=t}setExchangeUnresponsiveTimeout(t){this.unresponsiveTimeout=t}static create(t=3e3,e){return new Promise((r,n)=>{let i=!1;const s=this.listen({next:e=>{i=!0,s&&s.unsubscribe(),a&&clearTimeout(a),this.open(e.descriptor,t).then(r,n)},error:t=>{a&&clearTimeout(a),n(t)},complete:()=>{a&&clearTimeout(a),i||n(new o.TransportError(this.ErrorMessage_NoDeviceFound,"NoDeviceFound"))}}),a=e?setTimeout(()=>{s.unsubscribe(),n(new o.TransportError(this.ErrorMessage_ListenTimeout,"ListenTimeout"))},e):null})}decorateAppAPIMethods(t,e,r){for(let n of e)t[n]=this.decorateAppAPIMethod(n,t[n],t,r)}decorateAppAPIMethod(t,e,r,n){return async(...i)=>{const{_appAPIlock:s}=this;if(s)return Promise.reject(new o.TransportError("Ledger Device is busy (lock "+s+")","TransportLocked"));try{return this._appAPIlock=t,this.setScrambleKey(n),await e.apply(r,i)}finally{this._appAPIlock=null}}}}Transport.isSupported=void 0,Transport.list=void 0,Transport.listen=void 0,Transport.open=void 0,Transport.ErrorMessage_ListenTimeout="No Ledger device found (timeout)",Transport.ErrorMessage_NoDeviceFound="No Ledger device found"},5103:function(t,e,r){"use strict";r.r(e),r.d(e,"default",(function(){return TransportU2F}));var n=r(5104),i=r(4897),o=r(4647),s=r(4433);const a=t=>t.replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"");function c(t,e,r,i){const s=function(t,e){const r=Buffer.alloc(t.length);for(let n=0;n<t.length;n++)r[n]=t[n]^e[n%e.length];return r}(t,r),c=Buffer.from("0000000000000000000000000000000000000000000000000000000000000000","hex"),u={version:"U2F_V2",keyHandle:a(s.toString("base64")),challenge:a(c.toString("base64")),appId:location.origin};return Object(o.log)("apdu","=> "+t.toString("hex")),Object(n.sign)(u,e/1e3).then(t=>{const{signatureData:e}=t;if("string"==typeof e){const t=Buffer.from((r=e).replace(/-/g,"+").replace(/_/g,"/")+"==".substring(0,3*r.length%4),"base64");let n;return n=i?t.slice(5):t,Object(o.log)("apdu","<= "+n.toString("hex")),n}throw t;var r})}let u=[];class TransportU2F extends i.a{static async open(t,e=5e3){return new TransportU2F}constructor(){super(),this.scrambleKey=void 0,this.unwrap=!0,u.push(this)}async exchange(t){try{return await c(t,this.exchangeTimeout,this.scrambleKey,this.unwrap)}catch(t){throw"object"==typeof t.metaData?(5===t.metaData.code&&(u.forEach(t=>t.emit("disconnect")),u=[]),function(t,e,r){const n=new s.TransportError(e,r);return n.originalError=t,n}(t,"Failed to sign with Ledger device: U2F "+t.metaData.type,"U2F_"+t.metaData.code)):t}}setScrambleKey(t){this.scrambleKey=Buffer.from(t,"ascii")}setUnwrap(t){this.unwrap=t}close(){return Promise.resolve()}}TransportU2F.isSupported=n.isSupported,TransportU2F.list=()=>Object(n.isSupported)().then(t=>t?[null]:[]),TransportU2F.listen=t=>{let e=!1;return Object(n.isSupported)().then(r=>{e||(r?(t.next({type:"add",descriptor:null}),t.complete()):t.error(new s.TransportError("U2F browser support is needed for Ledger. Please use Chrome, Opera or Firefox with a U2F extension. Also make sure you're on an HTTPS connection","U2FNotSupported")))}),{unsubscribe:()=>{e=!0}}}},7939:function(t,e,r){"use strict";r.r(e),r.d(e,"default",(function(){return TransportWebBLE_BluetoothTransport}));var n=r(4897),i=r(4433),o=r(6255),s=r(6283),a=r(6284),c=r(4647),u=function(t,e){return(u=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function h(t,e){function r(){this.constructor=t}u(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}function l(t){return"function"==typeof t}var d=!1,f={Promise:void 0,set useDeprecatedSynchronousErrorHandling(t){t&&(new Error).stack;d=t},get useDeprecatedSynchronousErrorHandling(){return d}};function p(t){setTimeout((function(){throw t}),0)}var b={closed:!0,next:function(t){},error:function(t){if(f.useDeprecatedSynchronousErrorHandling)throw t;p(t)},complete:function(){}},y=function(){return Array.isArray||function(t){return t&&"number"==typeof t.length}}();function m(t){return null!==t&&"object"==typeof t}var g=function(){function t(t){return Error.call(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map((function(t,e){return e+1+") "+t.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t,this}return t.prototype=Object.create(Error.prototype),t}(),v=function(){function t(t){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,t&&(this._ctorUnsubscribe=!0,this._unsubscribe=t)}return t.prototype.unsubscribe=function(){var e;if(!this.closed){var r=this._parentOrParents,n=this._ctorUnsubscribe,i=this._unsubscribe,o=this._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,r instanceof t)r.remove(this);else if(null!==r)for(var s=0;s<r.length;++s){r[s].remove(this)}if(l(i)){n&&(this._unsubscribe=void 0);try{i.call(this)}catch(t){e=t instanceof g?w(t.errors):[t]}}if(y(o)){s=-1;for(var a=o.length;++s<a;){var c=o[s];if(m(c))try{c.unsubscribe()}catch(t){e=e||[],t instanceof g?e=e.concat(w(t.errors)):e.push(t)}}}if(e)throw new g(e)}},t.prototype.add=function(e){var r=e;if(!e)return t.EMPTY;switch(typeof e){case"function":r=new t(e);case"object":if(r===this||r.closed||"function"!=typeof r.unsubscribe)return r;if(this.closed)return r.unsubscribe(),r;if(!(r instanceof t)){var n=r;(r=new t)._subscriptions=[n]}break;default:throw new Error("unrecognized teardown "+e+" added to Subscription.")}var i=r._parentOrParents;if(null===i)r._parentOrParents=this;else if(i instanceof t){if(i===this)return r;r._parentOrParents=[i,this]}else{if(-1!==i.indexOf(this))return r;i.push(this)}var o=this._subscriptions;return null===o?this._subscriptions=[r]:o.push(r),r},t.prototype.remove=function(t){var e=this._subscriptions;if(e){var r=e.indexOf(t);-1!==r&&e.splice(r,1)}},t.EMPTY=function(t){return t.closed=!0,t}(new t),t}();function w(t){return t.reduce((function(t,e){return t.concat(e instanceof g?e.errors:e)}),[])}var T=function(){return"function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random()}(),_=function(t){function e(r,n,i){var o=t.call(this)||this;switch(o.syncErrorValue=null,o.syncErrorThrown=!1,o.syncErrorThrowable=!1,o.isStopped=!1,arguments.length){case 0:o.destination=b;break;case 1:if(!r){o.destination=b;break}if("object"==typeof r){r instanceof e?(o.syncErrorThrowable=r.syncErrorThrowable,o.destination=r,r.add(o)):(o.syncErrorThrowable=!0,o.destination=new S(o,r));break}default:o.syncErrorThrowable=!0,o.destination=new S(o,r,n,i)}return o}return h(e,t),e.prototype[T]=function(){return this},e.create=function(t,r,n){var i=new e(t,r,n);return i.syncErrorThrowable=!1,i},e.prototype.next=function(t){this.isStopped||this._next(t)},e.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this))},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){this.destination.error(t),this.unsubscribe()},e.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},e.prototype._unsubscribeAndRecycle=function(){var t=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=t,this},e}(v),S=function(t){function e(e,r,n,i){var o,s=t.call(this)||this;s._parentSubscriber=e;var a=s;return l(r)?o=r:r&&(o=r.next,n=r.error,i=r.complete,r!==b&&(l((a=Object.create(r)).unsubscribe)&&s.add(a.unsubscribe.bind(a)),a.unsubscribe=s.unsubscribe.bind(s))),s._context=a,s._next=o,s._error=n,s._complete=i,s}return h(e,t),e.prototype.next=function(t){if(!this.isStopped&&this._next){var e=this._parentSubscriber;f.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?this.__tryOrSetError(e,this._next,t)&&this.unsubscribe():this.__tryOrUnsub(this._next,t)}},e.prototype.error=function(t){if(!this.isStopped){var e=this._parentSubscriber,r=f.useDeprecatedSynchronousErrorHandling;if(this._error)r&&e.syncErrorThrowable?(this.__tryOrSetError(e,this._error,t),this.unsubscribe()):(this.__tryOrUnsub(this._error,t),this.unsubscribe());else if(e.syncErrorThrowable)r?(e.syncErrorValue=t,e.syncErrorThrown=!0):p(t),this.unsubscribe();else{if(this.unsubscribe(),r)throw t;p(t)}}},e.prototype.complete=function(){var t=this;if(!this.isStopped){var e=this._parentSubscriber;if(this._complete){var r=function(){return t._complete.call(t._context)};f.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?(this.__tryOrSetError(e,r),this.unsubscribe()):(this.__tryOrUnsub(r),this.unsubscribe())}else this.unsubscribe()}},e.prototype.__tryOrUnsub=function(t,e){try{t.call(this._context,e)}catch(t){if(this.unsubscribe(),f.useDeprecatedSynchronousErrorHandling)throw t;p(t)}},e.prototype.__tryOrSetError=function(t,e,r){if(!f.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{e.call(this._context,r)}catch(e){return f.useDeprecatedSynchronousErrorHandling?(t.syncErrorValue=e,t.syncErrorThrown=!0,!0):(p(e),!0)}return!1},e.prototype._unsubscribe=function(){var t=this._parentSubscriber;this._context=null,this._parentSubscriber=null,t.unsubscribe()},e}(_);var E=function(){return"function"==typeof Symbol&&Symbol.observable||"@@observable"}();function x(t){return t}function B(t){return 0===t.length?x:1===t.length?t[0]:function(e){return t.reduce((function(t,e){return e(t)}),e)}}var k=function(){function t(t){this._isScalar=!1,t&&(this._subscribe=t)}return t.prototype.lift=function(e){var r=new t;return r.source=this,r.operator=e,r},t.prototype.subscribe=function(t,e,r){var n=this.operator,i=function(t,e,r){if(t){if(t instanceof _)return t;if(t[T])return t[T]()}return t||e||r?new _(t,e,r):new _(b)}(t,e,r);if(n?i.add(n.call(i,this.source)):i.add(this.source||f.useDeprecatedSynchronousErrorHandling&&!i.syncErrorThrowable?this._subscribe(i):this._trySubscribe(i)),f.useDeprecatedSynchronousErrorHandling&&i.syncErrorThrowable&&(i.syncErrorThrowable=!1,i.syncErrorThrown))throw i.syncErrorValue;return i},t.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){f.useDeprecatedSynchronousErrorHandling&&(t.syncErrorThrown=!0,t.syncErrorValue=e),!function(t){for(;t;){var e=t,r=e.closed,n=e.destination,i=e.isStopped;if(r||i)return!1;t=n&&n instanceof _?n:null}return!0}(t)?console.warn(e):t.error(e)}},t.prototype.forEach=function(t,e){var r=this;return new(e=L(e))((function(e,n){var i;i=r.subscribe((function(e){try{t(e)}catch(t){n(t),i&&i.unsubscribe()}}),n,e)}))},t.prototype._subscribe=function(t){var e=this.source;return e&&e.subscribe(t)},t.prototype[E]=function(){return this},t.prototype.pipe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return 0===t.length?this:B(t)(this)},t.prototype.toPromise=function(t){var e=this;return new(t=L(t))((function(t,r){var n;e.subscribe((function(t){return n=t}),(function(t){return r(t)}),(function(){return t(n)}))}))},t.create=function(e){return new t(e)},t}();function L(t){if(t||(t=f.Promise||Promise),!t)throw new Error("no Promise impl found");return t}function N(t){return t&&"function"==typeof t.schedule}function O(t,e){return function(r){if("function"!=typeof t)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return r.lift(new P(t,e))}}var P=function(){function t(t,e){this.project=t,this.thisArg=e}return t.prototype.call=function(t,e){return e.subscribe(new C(t,this.project,this.thisArg))},t}(),C=function(t){function e(e,r,n){var i=t.call(this,e)||this;return i.project=r,i.count=0,i.thisArg=n||i,i}return h(e,t),e.prototype._next=function(t){var e;try{e=this.project.call(this.thisArg,t,this.count++)}catch(t){return void this.destination.error(t)}this.destination.next(e)},e}(_),j=function(t){return function(e){for(var r=0,n=t.length;r<n&&!e.closed;r++)e.next(t[r]);e.complete()}};function U(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}var F=U(),I=function(t){return t&&"number"==typeof t.length&&"function"!=typeof t};function A(t){return!!t&&"function"!=typeof t.subscribe&&"function"==typeof t.then}var D=function(t){if(t&&"function"==typeof t[E])return n=t,function(t){var e=n[E]();if("function"!=typeof e.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return e.subscribe(t)};if(I(t))return j(t);if(A(t))return r=t,function(t){return r.then((function(e){t.closed||(t.next(e),t.complete())}),(function(e){return t.error(e)})).then(null,p),t};if(t&&"function"==typeof t[F])return e=t,function(t){for(var r=e[F]();;){var n=void 0;try{n=r.next()}catch(e){return t.error(e),t}if(n.done){t.complete();break}if(t.next(n.value),t.closed)break}return"function"==typeof r.return&&t.add((function(){r.return&&r.return()})),t};var e,r,n,i=m(t)?"an invalid object":"'"+t+"'";throw new TypeError("You provided "+i+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.")};function M(t,e){return new k((function(r){var n=new v,i=0;return n.add(e.schedule((function(){i!==t.length?(r.next(t[i++]),r.closed||n.add(this.schedule())):r.complete()}))),n}))}function K(t,e){if(null!=t){if(function(t){return t&&"function"==typeof t[E]}(t))return function(t,e){return new k((function(r){var n=new v;return n.add(e.schedule((function(){var i=t[E]();n.add(i.subscribe({next:function(t){n.add(e.schedule((function(){return r.next(t)})))},error:function(t){n.add(e.schedule((function(){return r.error(t)})))},complete:function(){n.add(e.schedule((function(){return r.complete()})))}}))}))),n}))}(t,e);if(A(t))return function(t,e){return new k((function(r){var n=new v;return n.add(e.schedule((function(){return t.then((function(t){n.add(e.schedule((function(){r.next(t),n.add(e.schedule((function(){return r.complete()})))})))}),(function(t){n.add(e.schedule((function(){return r.error(t)})))}))}))),n}))}(t,e);if(I(t))return M(t,e);if(function(t){return t&&"function"==typeof t[F]}(t)||"string"==typeof t)return function(t,e){if(!t)throw new Error("Iterable cannot be null");return new k((function(r){var n,i=new v;return i.add((function(){n&&"function"==typeof n.return&&n.return()})),i.add(e.schedule((function(){n=t[F](),i.add(e.schedule((function(){if(!r.closed){var t,e;try{var i=n.next();t=i.value,e=i.done}catch(t){return void r.error(t)}e?r.complete():(r.next(t),this.schedule())}})))}))),i}))}(t,e)}throw new TypeError((null!==t&&typeof t||t)+" is not observable")}function V(t,e){return e?K(t,e):t instanceof k?t:new k(D(t))}var H=function(t){function e(e){var r=t.call(this)||this;return r.parent=e,r}return h(e,t),e.prototype._next=function(t){this.parent.notifyNext(t)},e.prototype._error=function(t){this.parent.notifyError(t),this.unsubscribe()},e.prototype._complete=function(){this.parent.notifyComplete(),this.unsubscribe()},e}(_),$=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return h(e,t),e.prototype.notifyNext=function(t){this.destination.next(t)},e.prototype.notifyError=function(t){this.destination.error(t)},e.prototype.notifyComplete=function(){this.destination.complete()},e}(_);function z(t,e,r){return void 0===r&&(r=Number.POSITIVE_INFINITY),"function"==typeof e?function(n){return n.pipe(z((function(r,n){return V(t(r,n)).pipe(O((function(t,i){return e(r,t,n,i)})))}),r))}:("number"==typeof e&&(r=e),function(e){return e.lift(new Y(t,r))})}var Y=function(){function t(t,e){void 0===e&&(e=Number.POSITIVE_INFINITY),this.project=t,this.concurrent=e}return t.prototype.call=function(t,e){return e.subscribe(new J(t,this.project,this.concurrent))},t}(),J=function(t){function e(e,r,n){void 0===n&&(n=Number.POSITIVE_INFINITY);var i=t.call(this,e)||this;return i.project=r,i.concurrent=n,i.hasCompleted=!1,i.buffer=[],i.active=0,i.index=0,i}return h(e,t),e.prototype._next=function(t){this.active<this.concurrent?this._tryNext(t):this.buffer.push(t)},e.prototype._tryNext=function(t){var e,r=this.index++;try{e=this.project(t,r)}catch(t){return void this.destination.error(t)}this.active++,this._innerSub(e)},e.prototype._innerSub=function(t){var e=new H(this),r=this.destination;r.add(e);var n=function(t,e){if(!e.closed){if(t instanceof k)return t.subscribe(e);var r;try{r=D(t)(e)}catch(t){e.error(t)}return r}}(t,e);n!==e&&r.add(n)},e.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()},e.prototype.notifyNext=function(t){this.destination.next(t)},e.prototype.notifyComplete=function(){var t=this.buffer;this.active--,t.length>0?this._next(t.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()},e}($);function W(t){return void 0===t&&(t=Number.POSITIVE_INFINITY),z(x,t)}function G(t,e){return e?M(t,e):new k(j(t))}function R(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=Number.POSITIVE_INFINITY,n=null,i=t[t.length-1];return N(i)?(n=t.pop(),t.length>1&&"number"==typeof t[t.length-1]&&(r=t.pop())):"number"==typeof i&&(r=t.pop()),null===n&&1===t.length&&t[0]instanceof k?t[0]:W(r)(G(t,n))}var Z=new k((function(t){return t.complete()}));function q(t){return t?function(t){return new k((function(e){return t.schedule((function(){return e.complete()}))}))}(t):Z}function X(){}var Q=function(){function t(t,e,r){this.nextOrObserver=t,this.error=e,this.complete=r}return t.prototype.call=function(t,e){return e.subscribe(new tt(t,this.nextOrObserver,this.error,this.complete))},t}(),tt=function(t){function e(e,r,n,i){var o=t.call(this,e)||this;return o._tapNext=X,o._tapError=X,o._tapComplete=X,o._tapError=n||X,o._tapComplete=i||X,l(r)?(o._context=o,o._tapNext=r):r&&(o._context=r,o._tapNext=r.next||X,o._tapError=r.error||X,o._tapComplete=r.complete||X),o}return h(e,t),e.prototype._next=function(t){try{this._tapNext.call(this._context,t)}catch(t){return void this.destination.error(t)}this.destination.next(t)},e.prototype._error=function(t){try{this._tapError.call(this._context,t)}catch(t){return void this.destination.error(t)}this.destination.error(t)},e.prototype._complete=function(){try{this._tapComplete.call(this._context)}catch(t){return void this.destination.error(t)}return this.destination.complete()},e}(_),et=function(){function t(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return t.prototype=Object.create(Error.prototype),t}(),rt=function(t){function e(e,r){var n=t.call(this)||this;return n.subject=e,n.subscriber=r,n.closed=!1,n}return h(e,t),e.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var t=this.subject,e=t.observers;if(this.subject=null,e&&0!==e.length&&!t.isStopped&&!t.closed){var r=e.indexOf(this.subscriber);-1!==r&&e.splice(r,1)}}},e}(v),nt=function(t){function e(e){var r=t.call(this,e)||this;return r.destination=e,r}return h(e,t),e}(_),it=function(t){function e(){var e=t.call(this)||this;return e.observers=[],e.closed=!1,e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return h(e,t),e.prototype[T]=function(){return new nt(this)},e.prototype.lift=function(t){var e=new ot(this,this);return e.operator=t,e},e.prototype.next=function(t){if(this.closed)throw new et;if(!this.isStopped)for(var e=this.observers,r=e.length,n=e.slice(),i=0;i<r;i++)n[i].next(t)},e.prototype.error=function(t){if(this.closed)throw new et;this.hasError=!0,this.thrownError=t,this.isStopped=!0;for(var e=this.observers,r=e.length,n=e.slice(),i=0;i<r;i++)n[i].error(t);this.observers.length=0},e.prototype.complete=function(){if(this.closed)throw new et;this.isStopped=!0;for(var t=this.observers,e=t.length,r=t.slice(),n=0;n<e;n++)r[n].complete();this.observers.length=0},e.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},e.prototype._trySubscribe=function(e){if(this.closed)throw new et;return t.prototype._trySubscribe.call(this,e)},e.prototype._subscribe=function(t){if(this.closed)throw new et;return this.hasError?(t.error(this.thrownError),v.EMPTY):this.isStopped?(t.complete(),v.EMPTY):(this.observers.push(t),new rt(this,t))},e.prototype.asObservable=function(){var t=new k;return t.source=this,t},e.create=function(t,e){return new ot(t,e)},e}(k),ot=function(t){function e(e,r){var n=t.call(this)||this;return n.destination=e,n.source=r,n}return h(e,t),e.prototype.next=function(t){var e=this.destination;e&&e.next&&e.next(t)},e.prototype.error=function(t){var e=this.destination;e&&e.error&&this.destination.error(t)},e.prototype.complete=function(){var t=this.destination;t&&t.complete&&this.destination.complete()},e.prototype._subscribe=function(t){return this.source?this.source.subscribe(t):v.EMPTY},e}(it);function st(){return function(t){return t.lift(new at(t))}}var at=function(){function t(t){this.connectable=t}return t.prototype.call=function(t,e){var r=this.connectable;r._refCount++;var n=new ct(t,r),i=e.subscribe(n);return n.closed||(n.connection=r.connect()),i},t}(),ct=function(t){function e(e,r){var n=t.call(this,e)||this;return n.connectable=r,n}return h(e,t),e.prototype._unsubscribe=function(){var t=this.connectable;if(t){this.connectable=null;var e=t._refCount;if(e<=0)this.connection=null;else if(t._refCount=e-1,e>1)this.connection=null;else{var r=this.connection,n=t._connection;this.connection=null,!n||r&&n!==r||n.unsubscribe()}}else this.connection=null},e}(_),ut=function(t){function e(e,r){var n=t.call(this)||this;return n.source=e,n.subjectFactory=r,n._refCount=0,n._isComplete=!1,n}return h(e,t),e.prototype._subscribe=function(t){return this.getSubject().subscribe(t)},e.prototype.getSubject=function(){var t=this._subject;return t&&!t.isStopped||(this._subject=this.subjectFactory()),this._subject},e.prototype.connect=function(){var t=this._connection;return t||(this._isComplete=!1,(t=this._connection=new v).add(this.source.subscribe(new lt(this.getSubject(),this))),t.closed&&(this._connection=null,t=v.EMPTY)),t},e.prototype.refCount=function(){return st()(this)},e}(k),ht=function(){var t=ut.prototype;return{operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:t._subscribe},_isComplete:{value:t._isComplete,writable:!0},getSubject:{value:t.getSubject},connect:{value:t.connect},refCount:{value:t.refCount}}}(),lt=function(t){function e(e,r){var n=t.call(this,e)||this;return n.connectable=r,n}return h(e,t),e.prototype._error=function(e){this._unsubscribe(),t.prototype._error.call(this,e)},e.prototype._complete=function(){this.connectable._isComplete=!0,this._unsubscribe(),t.prototype._complete.call(this)},e.prototype._unsubscribe=function(){var t=this.connectable;if(t){this.connectable=null;var e=t._connection;t._refCount=0,t._subject=null,t._connection=null,e&&e.unsubscribe()}},e}(nt);var dt=function(){function t(t,e){this.subjectFactory=t,this.selector=e}return t.prototype.call=function(t,e){var r=this.selector,n=this.subjectFactory(),i=r(n).subscribe(t);return i.add(e.subscribe(n)),i},t}();function ft(){return new it}function pt(){return function(t){return st()((e=ft,function(t){var n;if(n="function"==typeof e?e:function(){return e},"function"==typeof r)return t.lift(new dt(n,r));var i=Object.create(t,ht);return i.source=t,i.subjectFactory=n,i})(t));var e,r}}var bt=function(){function t(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}return t.prototype=Object.create(Error.prototype),t}();function yt(t,e){return function(r){return r.lift(new mt(t,e))}}var mt=function(){function t(t,e){this.predicate=t,this.thisArg=e}return t.prototype.call=function(t,e){return e.subscribe(new gt(t,this.predicate,this.thisArg))},t}(),gt=function(t){function e(e,r,n){var i=t.call(this,e)||this;return i.predicate=r,i.thisArg=n,i.count=0,i}return h(e,t),e.prototype._next=function(t){var e;try{e=this.predicate.call(this.thisArg,t,this.count++)}catch(t){return void this.destination.error(t)}e&&this.destination.next(t)},e}(_),vt=function(){function t(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return t.prototype=Object.create(Error.prototype),t}();function wt(t){return function(e){return 0===t?q():e.lift(new Tt(t))}}var Tt=function(){function t(t){if(this.total=t,this.total<0)throw new vt}return t.prototype.call=function(t,e){return e.subscribe(new _t(t,this.total))},t}(),_t=function(t){function e(e,r){var n=t.call(this,e)||this;return n.total=r,n.count=0,n}return h(e,t),e.prototype._next=function(t){var e=this.total,r=++this.count;r<=e&&(this.destination.next(t),r===e&&(this.destination.complete(),this.unsubscribe()))},e}(_);function St(t){return void 0===t&&(t=null),function(e){return e.lift(new Et(t))}}var Et=function(){function t(t){this.defaultValue=t}return t.prototype.call=function(t,e){return e.subscribe(new xt(t,this.defaultValue))},t}(),xt=function(t){function e(e,r){var n=t.call(this,e)||this;return n.defaultValue=r,n.isEmpty=!0,n}return h(e,t),e.prototype._next=function(t){this.isEmpty=!1,this.destination.next(t)},e.prototype._complete=function(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()},e}(_);function Bt(t){return void 0===t&&(t=Nt),function(e){return e.lift(new kt(t))}}var kt=function(){function t(t){this.errorFactory=t}return t.prototype.call=function(t,e){return e.subscribe(new Lt(t,this.errorFactory))},t}(),Lt=function(t){function e(e,r){var n=t.call(this,e)||this;return n.errorFactory=r,n.hasValue=!1,n}return h(e,t),e.prototype._next=function(t){this.hasValue=!0,this.destination.next(t)},e.prototype._complete=function(){if(this.hasValue)return this.destination.complete();var t=void 0;try{t=this.errorFactory()}catch(e){t=e}this.destination.error(t)},e}(_);function Nt(){return new bt}var Ot=function(){function t(){}return t.prototype.call=function(t,e){return e.subscribe(new Pt(t))},t}(),Pt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return h(e,t),e.prototype._next=function(t){},e}(_);const Ct=()=>{const{bluetooth:t}=navigator;if(void 0===t)throw new Error("web bluetooth not supported");return t},jt=()=>k.create(t=>{const e=Ct(),r=e=>{t.next(e.value)};e.addEventListener("availabilitychanged",r);let n=!1;return e.getAvailability().then(e=>{n||t.next(e)}),()=>{n=!0,e.removeEventListener("availabilitychanged",r)}}),Ut={},Ft=()=>({filters:Object(o.a)().map(t=>({services:[t]}))});async function It(t,e){let r;if("string"==typeof t){if(Ut[t])return Object(c.log)("ble-verbose","Transport in cache, using that."),Ut[t];const e=Ct();r=await e.requestDevice(Ft())}else r=t;r.gatt.connected||(Object(c.log)("ble-verbose","not connected. connecting..."),await r.gatt.connect());const[n,s]=await(async t=>{if(!t.gatt)throw new Error("bluetooth gatt not found");const[e]=await t.gatt.getPrimaryServices();if(!e)throw new Error("bluetooth service not found");const r=Object(o.b)(e.uuid);if(!r)throw new Error("bluetooth service infos not found");return[e,r]})(r),{deviceModel:a,writeUuid:u,notifyUuid:h}=s,[l,d]=await Promise.all([n.getCharacteristic(u),n.getCharacteristic(h)]),f=(m=d,k.create(t=>{function e(e){const r=e.target;r.value&&t.next(Buffer.from(r.value.buffer))}return Object(c.log)("ble-verbose","start monitor "+m.uuid),m.startNotifications().then(()=>{m.addEventListener("characteristicvaluechanged",e)}),()=>{Object(c.log)("ble-verbose","end monitor "+m.uuid),m.stopNotifications()}})).pipe((p=t=>{Object(c.log)("ble-frame","<= "+t.toString("hex"))},function(t){return t.lift(new Q(p,b,y))}),pt());var p,b,y,m;const g=f.subscribe(),v=new TransportWebBLE_BluetoothTransport(r,l,f,a);if(!r.gatt.connected)throw new i.DisconnectedDevice;Ut[v.id]=v;const w=t=>{console.log("onDisconnect!",t),delete Ut[v.id],v.notYetDisconnected=!1,g.unsubscribe(),r.removeEventListener("gattserverdisconnected",w),Object(c.log)("ble-verbose",`BleTransport(${v.id}) disconnected`),v.emit("disconnect",t)};r.addEventListener("gattserverdisconnected",w);let T=Date.now();try{await v.inferMTU()}finally{Date.now()-T<1e3&&(e=!1),e&&(await r.gatt.disconnect(),await new Promise(t=>setTimeout(t,4e3)))}return e?It(r,!1):v}class TransportWebBLE_BluetoothTransport extends n.a{static listen(t){let e;Object(c.log)("ble-verbose","listen...");return Ct().requestDevice(Ft()).then(async r=>{e||(t.next({type:"add",descriptor:r}),t.complete())},e=>{t.error(new i.TransportOpenUserCancelled(e.message))}),{unsubscribe:function(){e=!0}}}static async open(t){return It(t,!0)}constructor(t,e,r,n){super(),this.id=void 0,this.device=void 0,this.mtuSize=20,this.writeCharacteristic=void 0,this.notifyObservable=void 0,this.notYetDisconnected=!0,this.deviceModel=void 0,this.exchange=t=>this.exchangeAtomicImpl(async()=>{try{const e=t.toString("hex");Object(c.log)("apdu","=> "+e);const r=await R(this.notifyObservable.pipe(a.receiveAPDU),Object(s.sendAPDU)(this.write,t,this.mtuSize)).toPromise(),n=r.toString("hex");return Object(c.log)("apdu","<= "+n),r}catch(t){throw Object(c.log)("ble-error","exchange got "+String(t)),this.notYetDisconnected&&this.device.gatt.disconnect(),t}}),this.write=async t=>{Object(c.log)("ble-frame","=> "+t.toString("hex")),await this.writeCharacteristic.writeValue(t)},this.id=t.id,this.device=t,this.writeCharacteristic=e,this.notifyObservable=r,this.deviceModel=n,Object(c.log)("ble-verbose",`BleTransport(${String(this.id)}) new instance`)}async inferMTU(){let t=23;if(await this.exchangeAtomicImpl(async()=>{try{t=await R(this.notifyObservable.pipe(function(t,e){var r=arguments.length>=2;return function(n){return n.pipe(t?yt((function(e,r){return t(e,r,n)})):x,wt(1),r?St(e):Bt((function(){return new bt})))}}(t=>8===t.readUInt8(0)),O(t=>t.readUInt8(5))),(e=()=>V(this.write(Buffer.from([8,0,0,0,0]))),new k((function(t){var r;try{r=e()}catch(e){return void t.error(e)}return(r?V(r):q()).subscribe(t)}))).pipe((function(t){return t.lift(new Ot)}))).toPromise()+3}catch(t){throw Object(c.log)("ble-error","inferMTU got "+String(t)),this.device.gatt.disconnect(),t}var e}),t>23){const e=t-3;Object(c.log)("ble-verbose",`BleTransport(${String(this.id)}) mtu set to ${String(e)}`),this.mtuSize=e}return this.mtuSize}setScrambleKey(){}async close(){this.exchangeBusyPromise&&await this.exchangeBusyPromise}}TransportWebBLE_BluetoothTransport.isSupported=()=>Promise.resolve().then(Ct).then(()=>!0,()=>!1),TransportWebBLE_BluetoothTransport.observeAvailability=t=>jt.subscribe(t),TransportWebBLE_BluetoothTransport.list=()=>Promise.resolve([]),TransportWebBLE_BluetoothTransport.disconnect=async t=>{Object(c.log)("ble-verbose",`user disconnect(${t})`);const e=Ut[t];e&&e.device.gatt.disconnect()}}}]);